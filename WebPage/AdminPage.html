<!DOCTYPE html>

<html lang="en">
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="items.js"></script>
    <link rel="stylesheet" type="text/css" href="items.css">
    <title>Farmer's Market Application</title>
</head>
<body onload="main()">
    <!-- <iframe id="hiddenElementName" src="JSONCategoriesData.txt" onload="fetchData();" style="display: none;"></iframe> -->
    <div>
        <p>Header</p>
        <hr>
        <div class="add-items-section">
            <h2 id="addItems"><span>▷</span> Add or Edit Items</h2>
            <div id="items-section" class="indent" style="display: none;">
                <div id="search-section">
                    <h3 id="search"><span>▷</span> Search</h3>
                    <form style="display: none;" class="indent">
                        <p>
                            <label>Search by Item Name</label>
                            <input id="textSearchItem" type="text" />
                        </p>
                        <p>
                            <label>Category</label>
                            <select id="searchCategory">
                                <option>Select</option>
                                <option>Category 1</option>
                                <option>Category 2</option>
                                <option>Category 3</option>
                            </select>
                        </p>
                        <p>
                            <label>Sub-Category</label>
                            <select id="searchSubcategory" disabled>
                                <option>Select Category</option>
                            </select>
                        </p>
                        <p>
                            <label>Item</label>
                            <select id="searchItem">
                                <option>Example1</option>
                                <option>Example2</option>
                                <option>Example3</option>
                                <option>Example4</option>
                                <option>Example5</option>
                            </select>
                        </p>
                        <p>
                            <input id="searchButton" type="button" value="Search" onclick="" />
                        </p>
                    </form>
                </div>
                <h3>Item List <br> <span style="font-size:.75em">Click on a item to edit it</h3>
                <div id="itemList">
                    <div class="category-list">
                        <li class="category"><span>▷</span> Category 1</li>
                        <ul style="display: none;" class="item-list">
                            <li class="item">Item 1</li>
                            <li class="item">Item 2</li>
                            <li class="item">Item 3</li>
                        </ul>
                    </div>
                    <div class="category-list">
                        <li class="category"><span>▷</span> Category 2</li>
                        <ul style="display: none;" class="item-list">
                            <li class="item">Item 4</li>
                            <li class="item">Item 5</li>
                            <li class="item">Item 6</li>
                        </ul>
                    </div>
                    <div class="category-list">
                        <li class="category"><span>▷</span> Category 3</li>
                        <ul style="display: none;" class="item-list">
                            <li class="item">Item 7</li>
                            <li class="item">Item 8</li>
                            <li class="item">Item 9</li>
                            <li class="item">Item 10</li>
                        </ul>
                    </div>
                </div>
                <p>
                    <input id="clearSelection" type="button" value="Clear Selection" style="display: none;" />
                </p>

                <h3><span id="searchAddEdit">Add</span> Information</h3>
                <form>
                    <p>
                        <label>Name</label>
                        <input id="name" type="text" />
                    </p>
                    <p>
                    <p>Description</p>
                    <textarea id="description" name="description" rows="4" cols="50"></textarea>
                    </p>
                    <p>
                        <label>Examples</label><br>
                        <input id="examples" class="examples" type="text" />
                        <br><span id="addExample"> + Add Example </span>
                    </p>
                    <p>
                        <label>Category</label>
                        <select id="category">
                            <option>Select</option>
                            <option>Category 1</option>
                            <option>Category 2</option>
                            <option>Category 3</option>
                        </select>
                    </p>
                    <p>
                        <label>Sub-Category</label>
                        <select id="subcategory" disabled>
                            <option>Select a Category</option>
                        </select>
                    </p>
                    <p>
                        <label>Does it need a license?</label>
                        <input id="needsLicense" type="checkbox" />
                    </p>
                    <p>
                        <label>Does it need temperature control?</label>
                        <input id="temperatureControl" type="checkbox" />
                    </p>
                    <p>
                        <label>Is it SNAP eligible?</label>
                        <input id="snapEligible" type="checkbox" />
                    </p>
                    <p>
                        <label>Does it need tested?</label>
                        <input id="needsTested" type="checkbox" />
                    </p>

                    <p>
                        <input id="makeChanges" type="button" value="Add Item" onclick="OnUserClickAddItem();" />
                    </p>
                </form>
            </div>
            <hr>
            <div id="categories-section">
                <h2 id="addCategories"><span>▷</span> Add or Edit Categories</h2>
                <div id="category-form" class="indent" style="display: none;">
                    <form>
                        <p>
                            <label>Category</label>
                            <select id="editCategory">
                                <option>New Category</option>
                                <option>Category 1</option>
                                <option>Category 2</option>
                                <option>Category 3</option>
                            </select>
                        </p>
                        <p>
                            <label>Name</label>
                            <input id="catname" type="text" />
                        </p>
                        <p>
                            <input id="addCategory" type="button" value="Add Category" />
                        </p>

                    </form>
                </div>
            </div>
            <hr>
            <div id="subcategories-section">
                <h2 id="addSubcategories"><span>▷</span> Add or Edit Sub-Categories</h2>
                <div id="subcategory-form" class="indent" style="display: none;">
                    <form>
                        <p>
                            <label>Category</label>
                            <select id="searchCategory">
                                <option>Select</option>
                                <option>Category 1</option>
                                <option>Category 2</option>
                                <option>Category 3</option>
                            </select>
                        </p>
                        <p>
                            <label>Sub-Category</label>
                            <select id="searchSubcategory" disabled>
                                <option>Select Category</option>
                            </select>
                        </p>
                        <p>
                            <label>Name</label>
                            <input id="subname" type="text" />
                        </p>
                        <p>
                            <input id="addSubcategory" type="button" value="Add Sub-Category" />
                        </p>

                    </form>
                </div>
            </div>
        </div>
        <hr>
        <p>Footer</p>
        <script>
            /**@function main
             * Called when page first loads
             */
            function main() {
                let jsonData = fetchData();
                let root = new node("Category List", "root");
                root.children = jsonData.data.Nodes;
                createUIDisplayFoodItems(document.getElementById("itemList"), root);
                //addCategoriesToDropDown(document.getElementById("Category"), root);
            }

            items = document.getElementsByClassName('item');
            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                item.onclick = function (e) {
                    e.preventDefault();
                    document.getElementById("name").value = item.innerHTML;
                    document.getElementById("makeChanges").value = "Edit Item";
                }
            }

            /** @function OnUserClickAddItem
             * When user clicks 'Add Item', grab all relevant UI parameters and call function to add to data
             */
            function OnUserClickAddItem() {
                let name = document.getElementById("name");
                let description = document.getElementById("description");
                let example = document.getElementById("examples");
                let needsLicense = document.getElementById("needsLicense");
                let needsTemperatureControl = document.getElementById("needsTemperatureControl");
                let temperatureControl = document.getElementById("temperatureControl");
                let snapEligiable = document.getElementById("snapEligable");
                let needsTested = document.getElementById(" needsTested");

                addFoodItemToDictionary(name.textContent, description.textContent, example.textContent,
                    needsLicense.checked, needsTemperatureControl.checked, temperatureControl.checked,
                    snapEligiable.checked, needsTested.checked);
            }

            /** @function createUIDisplayFoodItems
             * creates a UI element to display all categories and food items
             * @param UIList the UI element to add to
             * @param node The node in the tree currently at
             * returns - UI element whose children are categories and food items
             */
            function createUIDisplayFoodItems(UIList, node) {
                //Process node
                let newCategory;
                if (node.type === "root") {
                    newCategory = UIList;
                }
                else {
                    newCategory = document.createElement('li');
                    newCategory.textContent = node.name;
                }                

                //Process children
                if (node.children != null) {
                    let newList = document.createElement('div');
                    newList.class = "category-list";
                    for (let i = 0; i < node.children.length; i++) {
                        if (typeof node.children[i] === "string") {
                            let foodItem = document.createElement('li');
                            foodItem.href = "";
                            foodItem.textContent = node.children[i];
                            foodItem.style.margin = "0px 0px 0px 50px";
                            foodItem.class = "item";
                            newList.appendChild(foodItem);
                        }
                        else {
                            newList.appendChild(createUIDisplayFoodItems(node.children[i]));
                        }
                    }
                    newCategory.appendChild(newList);
                }
                else {
                    let noItem = document.createElement('li');
                    noItem.textContent = "No Specified Food Items For Category";
                    newCategory.appendChild(noItem);
                }

                //return node
                return newCategory;
            }

            /** @function addCategoriesToDropDown
             * Adds all selectable categories for drop down
             * @param node The root of the tree
             */
            function addCategoriesToDropDown(dropDown, root) {
                if (root.children != null) {
                    for (let i = 0; i < root.children.length; i++) {
                        let newItem = document.createElement('option');
                        newItem.textContent = typeof root.children[i] === "string" ? root.children[i] : root.children[i].name;
                        dropDown.appendChild(newItem);
                    }
                }
            }

            /** @function downloadJSON
             * Downloads and exports the data into a new JSON file
             */
            function downloadJSON() {
                // TODO
            }

            ///
            /// NOTE: IMPORTANT: Functions below this point are here for testing and development purposes only:
            /// For final project copy and paste to appropriate file location and give correct URL to script src attribute
            ///

            function fetchData() {
                return {
                    alerts: ["Example Alert!", "Covid Prevention..."],
                    updates: ["Subcategory is now a Test subcategory"],
                    data:
                    {
                        Nodes: [{
                            type: "category",
                            name: "Dairy",
                            children: [
                                {
                                    type: "subcategory",
                                    name: "Milk",
                                    children: ["Whole Milk", "1% Milk", "2% Milk", "Skim Milk"]
                                },
                                "Butter"
                            ]
                        },
                        {
                            type: "category",
                            name: "Poultry",
                            children: [
                                "Chicken",
                                "Fried Chicken"
                            ]
                        },
                        {
                            type: "category",
                            name: "Fruit",
                            children: [
                                "Bananas",
                                "Apples",
                                {
                                    type: "subcategory",
                                    name: "Jam",
                                    children: ["Apple Jam", "Rasberry Jam", "Strawberry Jam"]
                                }
                            ]
                        },
                        ],
                        FoodItems: {
                            type: "FoodItem",
                            name: "Test Entry",
                            description: "This is a test entry",
                            examples: "",
                            license: false,
                            temperatureControl: false,
                            snapEligible: false,
                            testingRequired: false
                        }
                    }
                };
            }

            class node {
                constructor(name, type) {
                    this.name = name;
                    this.type = type;
                    this.parent = null;
                    this.children = [];
                }
            }
        </script>
    </div>
</body>
</html>