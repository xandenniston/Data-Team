<!DOCTYPE html>

<html lang="en">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="items.js"></script>
    <link rel="stylesheet" type="text/css" href="items.css">
    <title>Farmer's Market Application</title>
    
</head>
<body onload="loadPage()">
    <!-- <iframe id="hiddenElementName" src="JSONCategoriesData.txt" onload="fetchData();" style="display: none;"></iframe> -->
    <div>
        <img src="https://images.squarespace-cdn.com/content/v1/55464a70e4b0325625f5cc76/1594912220437-AF0I7IMMZXDBEU4CYAAG/ke17ZwdGBToddI8pDm48kJCiOAyW4OM9WPAJge-IoLpZw-zPPgdn4jUwVcJE1ZvWQUxwkmyExglNqGp0IvTJZamWLI2zvYWH8K3-s_4yszcp2ryTI0HqTOaaUohrI8PIhFl55zA7Im2wBnv_kx87bDE-LtIqB2_PMc4bIUdpwXE/KDA+Logo+Blue-Gold.png" alt="alternatetext" width="187" height="112" />
        <br><br>
        <input id="download" type="button" value="Download File" onclick="DownloadJSON();" />
        <div class="add-items-section">
            <h2 id="addItems"><span>▶</span> Add or Edit Items</h2>
            <div id="items-section" class="indent" style="display: none;">
                <div id="search-section">
                    <h3 id="search"><span>▶</span> Search</h3>
                    <form style="display: none;" class="indent">
                        <p>
                            <label>Search by Item Name</label>
                            <input id="textSearchItem" type="text" />
                        </p>
                        OR
                        <p>
                            <label>Category</label>
                            <select id="searchCategory">
                                <option>Select</option>                                
                            </select>
                        </p>
                        <p>
                            <label>Sub-Category</label>
                            <select id="searchSubcategory" disabled>
                                <option>Select Category</option>
                            </select>
                        </p>
                        <p>
                            <label>Item</label>
                            <select id="searchItem">
                                <option>Example1</option>
                                <option>Example2</option>
                                <option>Example3</option>
                                <option>Example4</option>
                                <option>Example5</option>
                            </select>
                        </p>
                        <p>
                            <input id="searchButton" type="button" value="Search" onclick="" />
                        </p>
                    </form>
                </div>
                <h3>Item List <br> <span style="font-size:.75em">Click on a item to edit it</h3>
                <div class="category-list">
                    <li class="category"><span>▶</span> Category 1</li>
                    <ul style="display: none;" class="item-list">
                        <li class="item">Item 1</li>
                        <li class="item">Item 2</li>
                        <li class="item">Item 3</li>
                    </ul>
                </div>
                <div class="category-list">
                    <li class="category"><span>▶</span> Category 2</li>
                    <ul style="display: none;" class="item-list">
                        <li class="item">Item 4</li>
                        <li class="item">Item 5</li>
                        <li class="item">Item 6</li>
                    </ul>
                </div>
                <div class="category-list">
                    <li class="category"><span>▶</span> Category 3</li>
                    <ul style="display: none;" class="item-list">
                        <li class="item">Item 7</li>
                        <li class="item">Item 8</li>
                        <li class="item">Item 9</li>
                        <li class="item">Item 10</li>
                    </ul>
                </div>
                <p>
                    <input id="clearSelection" type="button" value="Clear Selection" style="display: none;" />
                </p>

                <h3><span id="searchAddEdit">Add</span> Information</h3>
                <form>
                    <p>
                        <label>Name</label>
                        <input id="name" type="text" />
                    </p>
                    <p>
                    <p>Description</p>
                    <textarea id="description" name="description" rows="4" cols="50"></textarea>
                    </p>
                    <p>
                        <label>Examples</label><br>
                        <input id="examples" class="examples" type="text" />
                        <br><span id="addExample"> + Add Example </span>
                    </p>
                    <p>
                        <label>Category</label>
                        <select id="category">
                            <option>Select</option>                            
                        </select>
                    </p>
                    <p>
                        <label>Sub-Category</label>
                        <select id="subcategory" disabled>
                            <option>Select a Category</option>
                        </select>
                    </p>
                    <p>
                        <label>Does it need a license?</label>
                        <input id="needsLicense" type="checkbox" />
                    </p>
                    <p>
                        <label>Does it need temperature control?</label>
                        <input id="temperatureControl" type="checkbox" />
                    </p>
                    <p>
                        <label>Is it SNAP eligible?</label>
                        <input id="snapEligible" type="checkbox" />
                    </p>
                    <p>
                        <label>Does it need tested?</label>
                        <input id="needsTested" type="checkbox" />
                    </p>

                    <p>
                        <label>Additional Requirements</label><br>
                        <textarea id="req" class="requirements" name="description" rows="2" cols="40"></textarea>
                        <br><span id="addReq"> + Add Requirement </span>
                    </p>

                    <p>
                        <input id="makeChanges" type="button" value="Save Changes" onclick="onUserClickItemSaveChangesAddItem()"/>
                    <p id="itemSuccess"></p>
                    </p>
                </form>
            </div>
            <div id="categories-section">
                <h2 id="addCategories"><span>▶</span> Add or Edit Categories</h2>
                <div id="category-form" class="indent" style="display: none;">
                    <form>
                        <p>
                            <label>Category</label>
                            <select id="editCategory">
                                <option>New Category</option>                                
                            </select>
                        </p>
                        <p>
                            <label>Name</label>
                            <input id="catname" type="text" />
                        </p>
                        <p>
                            <input id="addCategory" type="button" value="Add Category" />
                        <p id="categorySuccess"></p>

                        </p>

                    </form>
                </div>
            </div>
            <div id="subcategories-section">
                <h2 id="addSubcategories"><span>▶</span> Add or Edit Sub-Categories</h2>
                <div id="subcategory-form" class="indent" style="display: none;">
                    <form>
                        <p>
                            <label>Category</label>
                            <select id="editCat">
                                <option>Select</option>                                
                            </select>
                        </p>
                        <p>
                            <label>Sub-Category</label>
                            <select id="editSubcat" disabled>
                                <option>Select Category</option>
                            </select>
                        </p>
                        <p>
                            <label>Name</label>
                            <input id="subname" type="text" />
                        </p>
                        <p>
                            <input id="addSubcategory" type="button" value="Add Sub-Category" />
                        <p id="subcategorySuccess"></p>
                        </p>

                    </form>
                </div>
            </div>
        </div>
        <br>
        <p> <img src="https://www.communications.k-state.edu/communications-solutions-and-services/logos/WhiteBackNoPClink.jpg" alt="alternatetext" width="151" height="42" /> </p>
    </div>
    <script>
        /** @function loadPage
         * Load and build page based on json structure currently stored in the server
         */
        function loadPage() {
            let jsonData = fetchData();
            let categoryTree = new tree("root");
            let itemDictionary = jsonData.data.FoodItems;
            categoryTree.root.children = jsonData.data.Nodes;
            populateUICategories(categoryTree);
        }

        /** @function populateUICategories
         * Populates all UI dropdown categories
         * @param {Tree} categoryTree - The category tree to traverse
         */
        function populateUICategories(categoryTree) {
            populateDropDownCategories(categoryTree, "searchCategory");
            populateDropDownCategories(categoryTree, "category");
            populateDropDownCategories(categoryTree, "editCategory");
            populateDropDownCategories(categoryTree, "editCat");
        }

        /** @function populateDropDownCategories
         * Populates a drop down for categories
         * @param {Tree} categoryTree - The tree to traverse
         * @param {string} dropDownID - The string id of the html element to add to 
         */
        function populateDropDownCategories(categoryTree, dropDownID) {
            let dropDown = document.getElementById(dropDownID);
            for (let i = 0; i < categoryTree.root.children.length; i++) {
                let newCategoryOption = document.createElement('option');
                newCategoryOption.textContent = categoryTree.root.children[i].name;
                dropDown.appendChild(newCategoryOption);
            }
        }

        /** @function onUserClickItemSaveChanges
        * When user clicks 'Add Item', grab all relevant UI parameters and call function to add to data
        */
        function onUserClickItemSaveChangesAddItem() {
            let name = document.getElementById( "name" );
            let description = document.getElementById( "description" );
            let example = document.getElementById( "examples" );
            let needsLicense = document.getElementById( "needsLicense" );
            let needsTemperatureControl = document.getElementById( "needsTemperatureControl" );
            let temperatureControl = document.getElementById( "temperatureControl" );
            let snapEligiable = document.getElementById( "snapEligable" );
            let needsTested = document.getElementById(" needsTested");

            addFoodItemToDictionary( name.textContent, description.textContent, example.textContent,
                                     needsLicense.checked, needsTemperatureControl.checked, temperatureControl.checked,
                                     snapEligiable.checked, needsTested.checked );
        }

            ///
            /// NOTE: IMPORTANT: Functions below this point are here for testing and development purposes only: 
            /// For final project copy and paste to appropriate file location and give correct URL to script src attribute
            ///

            function fetchData() {
                return {
                    alerts: ["Example Alert!", "Covid Prevention..."],
                    updates: ["Subcategory is now a Test subcategory"],
                    data:
                    {                        
                        Nodes: [{
                            type: "category",
                            name: "Dairy",
                            children: [
                                {
                                    type: "subcategory",
                                    name: "Milk",
                                    children: ["Whole Milk", "1% Milk", "2% Milk", "Skim Milk"]
                                },             
                                "Butter"
                            ]
                        },
                        {
                            type: "category",
                            name: "Poultry",
                            children: [
                                "Chicken",
                                "Fried Chicken"
                            ]
                            },
                        {
                            type: "category",
                            name: "Fruit",
                            children: [
                                "Bananas",
                                "Apples",
                                {
                                    type: "subcategory",
                                    name: "Jam",
                                    children: ["Apple Jam", "Rasberry Jam", "Strawberry Jam"]
                                }
                            ]
                        },
                        ],                        
                        FoodItems: {
                            type: "FoodItem",
                            name: "Test Entry",
                            description: "This is a test entry",
                            examples: "",
                            license: false,
                            temperatureControl: false,
                            snapEligible: false,
                            testingRequired: false
                        }
                    }
                };    
            }           

            class node {
                constructor(name, type) {
                    this.name = name;
                    this.type = type;
                    this.parent = null;
                    this.children = [];
                }
        }

        /**@class tree
        * 
        * @param name this is the name of your tree. This can probably just be "root"
        */
        class tree {
            constructor(name) {
            var n = new node(name, "root", []);
            this.root = n;
            }
        }
    </script>
</body>

</html>